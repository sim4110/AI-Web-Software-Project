<!DOCTYPE html>
{% load static %}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ store.store_name }}</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
    <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=&libraries=services"></script>
    
</head>
<body>
    <h1>{{ store.store_name }}</h1>
    <table>
        <tr>
            <th>상호명</th>
            <td>{{ store.store_name }}</td>
        </tr>
        <tr>
            <th>대표자</th>
            <td>{{ store.store_owner }}</td>
        </tr>
        <tr>
            <th>Telephone</th>
            <td>{{ store.tel_num }}</td>
        </tr>
        <tr>
            <th>마취여부</th>
            <td>{{ store.anesthesia }}</td>
        </tr>
        <tr>
            <th>Open Time</th>
            <td>{{ store.opentime }}</td>
        </tr>
        <tr>
            <th>Close Time</th>
            <td>{{ store.closetime }}</td>
        </tr>
        <tr>
            <th>가게 이미지</th>
            <td>
                {% if store.store_image %}
                    <img src="{{ store.store_image.url }}" alt="Store Image">
                {% else %}
                    No image available.
                {% endif %}
            </td>
        </tr>
        <tr>
            <th>수상 및 자격 목록</th>
            <td>
                <ul>
                    {% for qualification in store.qualifications.all %}
                        <li>{{ qualification.description }}</li>
                    {% endfor %}
                </ul>
            </td>
        </tr>
        <tr>
            <th>주소</th>
            <td>
                <p>{{ store.address }} {{ store.detail_address }} {{ store.extra_address }}</p>
            </td>
        </tr>
        <tr>
            <th>가게 위치</th>
            <td>
                <div id="map" style="width:800px;height:400px;"></div>
                <script>
                     document.addEventListener('DOMContentLoaded', function() {
                        var mapContainer = document.getElementById('map');
                        var mapOption = {
                            center: new kakao.maps.LatLng(37.5665, 126.9780), // 기본 중심 좌표
                            level: 3 // 확대 레벨
                        };
                        var map = new kakao.maps.Map(mapContainer, mapOption);

                        var geocoder = new kakao.maps.services.Geocoder();
                        var address = '{{ store.address }} {{ store.detail_address }} {{ store.extra_address }}';
                        
                        geocoder.addressSearch(address, function(result, status) {
                            if (status === kakao.maps.services.Status.OK) {
                                var coords = new kakao.maps.LatLng(result[0].y, result[0].x);
                                var marker = new kakao.maps.Marker({
                                    map: map,
                                    position: coords
                                });
                                map.setCenter(coords);
                            } else {
                                alert("주소를 찾을 수 없습니다.");
                            }
                        });
                    });
                </script>
                <!-- //https://apis.map.kakao.com/web/sample/addr2coord/  - 주소로 장소 표현하기 -->
                <!-- https://guiyomi.tistory.com/80 geocooder사용하기 -->
                    
                </script>
            </td>

        </tr>

    </table>
    
    <h2>Actions</h2>
    <form method="get" action="{% url 'petgrooming:storeEdit' store.id %}">
        {% csrf_token %}
        <button type="submit">Edit Store</button>
    </form>

    <form method="post" action="{% url 'petgrooming:storeDelete' store.id %}" onsubmit="return confirm('정말로 홍보글을 삭제하시겠습니까?');">
        {% csrf_token %}
        <button type="submit">Delete Store</button>
    </form>

    <form method="post" action="{% url 'petgrooming:storeRead' store.id %}">
        {% csrf_token %}
        <input type="hidden" name="STATUS" value="LIKE">
        <button type="submit">Like</button>
    </form>

    <form method="post" action="{% url 'petgrooming:storeScrap' store.id %}">
        {% csrf_token %}
        <button type="submit">Scrap</button>
    </form>



    <h2>댓글창</h2>
    <form method="post" action="{% url 'petgrooming:storeRead' store.id %}">
        {% csrf_token %}
        <input type="hidden" name="STATUS" value="CREATE">
        <input type="text" name="content" placeholder="Add a comment">
        <button type="submit">Add Comment</button>
    </form>

    <ul>
        {% for comment in comments %}
            <li>
                <p>{{ comment.writer }}: {{ comment.content }}</p>
                <form method="post" action="{% url 'petgrooming:storeRead' store.id %}">
                    {% csrf_token %}
                    <input type="hidden" name="STATUS" value="DELETE">
                    <input type="hidden" name="comment_id" value="{{ comment.id }}">
                    <button type="submit">Delete</button>
                </form>
                <form method="post" action="{% url 'petgrooming:storeRead' store.id %}">
                    {% csrf_token %}
                    <input type="hidden" name="STATUS" value="EDIT">
                    <input type="hidden" name="comment_id" value="{{ comment.id }}">
                    <input type="text" name="content" value="{{ comment.content }}">
                    <button type="submit">Edit</button>
                </form>
            </li>
        {% endfor %}
    </ul>
</body>
</html>
